<div class='container-fluid stream-on'>
    <select class="form-select">
        <option selected="selected" value='{{ current_user.location["country_code"] }}'>{{
            current_user.location["country"] }}</option>
        {% for key, value in countries.items() %}
        <option value="{{ key }}">{{ value }}</option>
        {% endfor %}
    </select>
    <h6>Stream on:</h6>
    <div id="content" data="{{ item_id }}">
        {% for i in results["watch/providers"] %}
        <img class='logo' src='{{i["logo_path"]}}'>
        {% endfor %}
    </div>
    <p> Powered by <a href="https://www.justwatch.com/JustWatch">JustWatch</a></p>
</div>



<script>
    $(document).ready(function () {

        var logoPath = "http://image.tmdb.org/t/p/original";
        var itemId = $("#content").attr("data");
        var pathName = "/watch_providers/";

        $.ajax($SCRIPT_ROOT + pathName + itemId).done(function (data) {
            var countries = data;
            console.log(countries);
            changeStreamLogos(countries);
        });

        function changeStreamLogos(countries) {
            $("select")
                .change(function () {
                    var countryCode = $(this).val();
                    $("#content").text(countryCode);
                    try {
                        var watchFree = countries.results[countryCode].flatrate;
                    }
                    catch (err) {
                        console.log(err);
                        try {
                            var watchFree = countries.results[countryCode].free;
                        }
                        catch (err) {
                            console.log(err);
                            var watchFree = null;
                        }
                    }
                    console.log(watchFree);
                    if (watchFree !== null) {
                        $("#content").empty();
                        watchFree.forEach((item) => {
                            item.logo_path = logoPath + item.logo_path;
                            $("#content").append("<img class='logo' src='" + item.logo_path + "'>")


                        });
                    }

                });
        }
    });
</script>